@model EventTickets.Models.Purchase
@{ var eventsList = ViewBag.Events as List<EventTickets.Models.Event> ?? new(); }
<h1>Guest Ticket Purchase</h1>
<div asp-validation-summary="All" class="text-danger" style="margin:.5rem 0;"></div>
<form asp-action="Create" method="post">
  <div>
    <label asp-for="EventId">Event</label>
    <select asp-for="EventId">
      @foreach (var e in eventsList) {
        var soldOut = e.AvailableTickets <= 0;
        <option value="@e.Id" disabled="@(soldOut)">
          @e.Title (@(e.DateTime?.ToString("yyyy-MM-dd") ?? "-"))
          @(soldOut ? " — SOLD OUT" : $" — {e.AvailableTickets} left")
          — $@e.Price
        </option>
      }
    </select>
    <span class="muted">Sold out events are disabled.</span>
  </div>
  <div><label asp-for="Quantity"></label><input asp-for="Quantity" min="1" /><span asp-validation-for="Quantity" class="text-danger"></span></div>
  <div><label asp-for="CustomerName"></label><input asp-for="CustomerName" /><span asp-validation-for="CustomerName" class="text-danger"></span></div>
  <div><label asp-for="Email"></label><input asp-for="Email" /><span asp-validation-for="Email" class="text-danger"></span></div>
  <button class="btn" type="submit">Continue</button> <a class="btn btn-outline" asp-controller="Home" asp-action="Index">Cancel</a>
</form>
@section Scripts { <partial name="_ValidationScriptsPartial" /> }
